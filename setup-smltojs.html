<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>setup-smltojs</title>
<!-- 2019-02-28 Thu 10:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Explorer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">setup-smltojs</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Error: Failed to find info for file: ../../js/basis/basis.mlb</a></li>
</ul>
</div>
</div>
<p>
I need autoconf and MLton.
MLKit is not necessary (unconfirmed).
</p>

<p>
autoconf has no dependent package.
MLton gmp will be installed together.
</p>

<p>
$ brew install autoconf
$ brew install mlton
It takes some time for make.
</p>

<p>
$ mkdir ~ / Programming / SMLtoJs; cd $ _
$ git clone <a href="https://github.com/melsman/mlkit.git">https://github.com/melsman/mlkit.git</a> smltojs
$ cd smltojs
$ ./autobuild
$ ./configure
$ make smltojs
$ make smltojs<sub>basislibs</sub>
$ ./bin/smltojs &#x2013;help
The readability of the generated JavaScript file is low feeling.
JavaScript is only the target language, it seems that operation at JavaScript level is not supposed. (Unlike PureScript and BuckleScript)
</p>

<p>
Compile SMLtoJs itself into JavaScript
</p>

<p>
I want to run SMLtoJs in Node.js.
</p>

<p>
<a href="https://github.com/melsman/mlkit/blob/master/README_SMLTOJS.md">https://github.com/melsman/mlkit/blob/master/README_SMLTOJS.md</a>
To build the browser-hosted compiler, proceed as follows:
</p>

<p>
$ cd ../../src/Compiler
$ SML<sub>LIB</sub> = $ (HOME) / smltojs / js ../../bin/smltojs - aopt smltojs0.mlb
The last command should generate a file run.html which links to all necessary JavaScript sources. Executing
</p>

<p>
$ firefox run.html
will start up a simple IDE for the compiler.
$ cd ../../src/Compiler
$ SML<sub>LIB</sub> = .. / .. / js ../../bin/smltojs - aopt smltojs0.mlb
An error occurs
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Error: Failed to find info for file: ../../js/basis/basis.mlb</h2>
<div class="outline-text-2" id="text-1">
<p>
Details: No such file or directory
The error message seems to be output in src / Tools / MlbMake / MlbFileSys.sml.
ST is defined in ./basis/POSIX<sub>FILE</sub><sub>SYS</sub>.sml.
</p>

<p>
If it changed to absolute path it was ok.
</p>

<p>
$ cd $ {HOME} / Programming / SMLtoJs / smltojs
$ mkdir Build; cd $ _
$ SML<sub>LIB</sub> = $ {PWD} <i>..</i> js $ {PWD} <i>..</i> bin / smltojs - aopt $ {PWD} <i>..</i> src / Compiler / smltojs0.mlb
However, another error occurred.
</p>

<p>
&#x2026; / Programming / SMLtoJs / smltojs / Build / .. / js / appfun / AppFun2.sml, line 884, column 6:
    val () = attachToElement (getElem "body") everything
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Type clash,
   type of left-hand side pattern: unit
   type of right-hand side expression: (unit-&gt; unit) -&gt; unit
<i>ERR in sub process:
  PARSE_ELAB_ERROR</i>
Stopping compilation of MLB-file due to error (code 1).
Since AppFun 2 seems unnecessary, it seems no problem to delete it.
</p>

<p>
Since attachToElement is a three-argument function, only two arguments are passed, so the partially applied function becomes an expression that returns.
It seems better to add arguments.
</p>

<p>
Fixed AppFun2.sml for the time being.
</p>

<ul class="org-ul">
<li>val () = attachToElement (getElem "body") everything
</li>
<li>val () = attachToElement (getElem "body") everything (fn () =&gt; ())
</li>
</ul>
<p>
Once compiled successfully.
</p>

<p>
It seems that adding a js<sub>path</sub><sub>compress</sub> option will normalize the path.
</p>

<p>
$ export JS<sub>PATH</sub><sub>FLAGS</sub> = "- js<sub>path</sub><sub>compress</sub>"
$ cd $ {HOME} / Programming / SMLtoJs / smltojs
$ mkdir Build; cd $ _
$ SML<sub>LIB</sub> = $ {PWD} <i>..</i> js $ {PWD} <i>..</i> bin / smltojs - aopt $ {JS<sub>PATH</sub><sub>FLAGS</sub>} $ {PWD} <i>..</i> src / Compiler / smltojs0.mlb
List of generated JavaScript files:
</p>

<p>
$ cat run.html | sed 's / &lt;script type = \ "text \ / javascript \" src = \ "<i>/' | sed 's / \"&gt; &lt;\ / script&gt; /</i>' | grep - v ' &lt;! - '&gt; files.txt
Copy file
</p>

<p>
$ cat files.txt | while read i; do cat $ {i} &gt;&gt; smltojs.js; done
Because it contained DOM libraries, it was not possible to run in Node.js (maybe you should use jsdom).
</p>

<p>
$ node smltojs.js
Build smltojs.mlb.
</p>

<p>
$ export JS<sub>PATH</sub><sub>FLAGS</sub> = "- js<sub>path</sub><sub>compress</sub>"
$ cd $ {HOME} / Programming / SMLtoJs / smltojs
$ mkdir Build 1; cd $ _
$ SML<sub>LIB</sub> = $ {PWD} <i>..</i> js $ {PWD} <i>..</i> bin / smltojs - aopt $ {JS<sub>PATH</sub><sub>FLAGS</sub>} $ {PWD} <i>..</i> src / Compiler / smltojs.mlb
This failed to build due to an error.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Explorer</p>
<p class="date">Created: 2019-02-28 Thu 10:02</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
